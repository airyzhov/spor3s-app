# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é spor3s-app

## üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

–ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –≤–µ—Ç–∫—É `main` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ VPS.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)

1. **–î–æ–±–∞–≤—å—Ç–µ SSH –∫–ª—é—á –Ω–∞ VPS:**
   ```bash
   ssh root@185.166.197.49
   mkdir -p ~/.ssh
   echo '–í–ê–®_–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_GITHUB_ACTIONS' >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions
   - –î–æ–±–∞–≤—å—Ç–µ:
     - `VPS_HOST`: `185.166.197.49`
     - `VPS_USER`: `root`
     - `VPS_SSH_KEY`: –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
     - `OPENROUTER_API_KEY`: –≤–∞—à API –∫–ª—é—á OpenRouter

3. **–î–µ–ø–ª–æ–π:**
   ```bash
   git add .
   git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
   git push origin main
   ```

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ –Ω–∞ VPS
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –°–æ–±–µ—Ä–µ—Ç Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã

## üîß –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
./deploy-vps-github.sh
```

–ò–ª–∏ –Ω–∞ VPS:

```bash
ssh root@185.166.197.49
cd /var/www/spor3s-app
git pull origin main
cd spor3s-app  # –∏–ª–∏ –∫–æ—Ä–µ–Ω—å, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
npm ci
npm run build
cd /var/www/spor3s-app
pm2 restart ecosystem.config.js
pm2 save
```

## üåê –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** https://ai.spor3s.ru
- **Health check:** https://ai.spor3s.ru/api/health
- **PM2 —Å—Ç–∞—Ç—É—Å:**
  ```bash
  ssh root@185.166.197.49
  pm2 list
  pm2 logs spor3s-nextjs
  ```

## üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- **GitHub Actions:** `.github/workflows/deploy.yml`
- **PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `ecosystem.config.js`
- **Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `spor3s-app/next.config.js`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** `spor3s-app/env.local` ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `.env.local` –Ω–∞ VPS

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SSH
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys` –Ω–∞ VPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewall

### –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ Next.js
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `npm ci`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs spor3s-nextjs`

### –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env.local` –Ω–∞ VPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω `ai.spor3s.ru` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ nginx
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç 3000: `netstat -tlnp | grep 3000`
