#!/bin/bash

echo "üõë –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."

# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã PM2
echo "üìã –û—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pm2 stop all || true
pm2 delete all || true
pm2 kill || true

# 2. –£–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js
echo "üî™ –£–±–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js..."
pkill -9 node || true
killall -9 node || true

# 3. –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç—É 3000
echo "üî™ –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç 3000..."
# –ù–∞—Ö–æ–¥–∏–º PID –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 3000
PID=$(lsof -ti:3000 2>/dev/null || fuser 3000/tcp 2>/dev/null | awk '{print $1}' || netstat -tlnp 2>/dev/null | grep :3000 | awk '{print $7}' | cut -d'/' -f1)
if [ -n "$PID" ]; then
    echo "üî™ –ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000: $PID"
    kill -9 $PID 2>/dev/null || true
    # –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ lsof
    lsof -ti:3000 | xargs kill -9 2>/dev/null || true
fi

# 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ netstat
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 3000 —á–µ—Ä–µ–∑ netstat..."
netstat -tlnp 2>/dev/null | grep :3000 | while read line; do
    PID=$(echo $line | awk '{print $7}' | cut -d'/' -f1)
    if [ -n "$PID" ] && [ "$PID" != "-" ]; then
        echo "üî™ –£–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å $PID..."
        kill -9 $PID 2>/dev/null || true
    fi
done

# 5. –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
echo "‚è≥ –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã..."
sleep 3

# 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 3000..."
if lsof -ti:3000 >/dev/null 2>&1 || netstat -tlnp 2>/dev/null | grep -q :3000; then
    echo "‚ö†Ô∏è –ü–æ—Ä—Ç 3000 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑..."
    lsof -ti:3000 | xargs kill -9 2>/dev/null || true
    sleep 2
else
    echo "‚úÖ –ü–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω!"
fi

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º PM2
echo "üìä –°—Ç–∞—Ç—É—Å PM2:"
pm2 list || echo "PM2 –Ω–µ –∑–∞–ø—É—â–µ–Ω (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)"

# 8. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js
echo "üìä –ü—Ä–æ—Ü–µ—Å—Å—ã Node.js:"
ps aux | grep node | grep -v grep || echo "–ü—Ä–æ—Ü–µ—Å—Å—ã Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

echo "‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

