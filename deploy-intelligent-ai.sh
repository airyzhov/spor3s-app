#!/bin/bash

echo "üöÄ –î–µ–ø–ª–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö AI –∞–≥–µ–Ω—Ç–æ–≤ —Å RAG –Ω–∞ VPS..."

# –ö–æ–ø–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ VPS
echo "üìÅ –ö–æ–ø–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã..."

# –ö–æ–ø–∏—Ä—É–µ–º AI API —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º fallback
scp spor3s-app/app/api/ai/route.ts root@185.166.197.49:/root/spor3s-app/app/api/ai/route.ts

# –ö–æ–ø–∏—Ä—É–µ–º Telegram –±–æ—Ç–∞ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º fallback
scp tg-bot/bot.ts root@185.166.197.49:/root/spor3s-app/tg-bot/bot.ts

# –ö–æ–ø–∏—Ä—É–µ–º spor3z –∞–≥–µ–Ω—Ç–∞ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º fallback
scp spor3s-app/start-spor3z-improved.js root@185.166.197.49:/root/spor3s-app/start-spor3z-improved.js

echo "‚úÖ –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã"

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ VPS –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ VPS..."

ssh root@185.166.197.49 << 'EOF'
cd /root/spor3s-app

echo "üì¶ –°–æ–±–∏—Ä–∞–µ–º Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
npm run build

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pm2 restart spor3s-nextjs --update-env
pm2 restart spor3s-bot --update-env  
pm2 restart spor3z-agent --update-env

echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
pm2 status

echo "üìù –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Å—Ç—Ä–æ–∫:"
pm2 logs --lines 5

echo "‚úÖ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ AI –∞–≥–µ–Ω—Ç—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã!"
echo "üéØ –¢–µ–ø–µ—Ä—å –≤—Å–µ –∞–≥–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç OpenRouter + –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π fallback"
echo "üß† RAG —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤"
EOF

echo "üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo "üîó –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É: https://ai.spor3s.ru"
echo "ü§ñ Telegram –±–æ—Ç: @spor3s_bot"
