# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ –≤—Å–µ—Ö —á–∞—Ç–∞—Ö

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–í—Å–µ —Ç—Ä–∏ —á–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–∏–∞–ª–æ–≥–∞:

### 1. ‚ùå **Telegram Bot API** (spor3s_bot)
```typescript
// –ë–´–õ–û: –ø–æ–ª—É—á–∞–ª —Ç–æ–ª—å–∫–æ content –±–µ–∑ role
const { data: recentMessages } = await supabase
  .from('messages')
  .select('content')  // –Ω–µ—Ç role!
  
const messages = recentMessages?.reverse().map(msg => ({
  role: 'user',  // –í–°–ï –∫–∞–∫ user!
  content: msg.content
}))
```

### 2. ‚ùå **Mini App Chat** 
```typescript
// –ë–´–õ–û: –≤–æ–æ–±—â–µ –ù–ï –ø–µ—Ä–µ–¥–∞–≤–∞–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç!
body: JSON.stringify({
  message: input.trim(),
  user_id: userId,
  source: 'mini_app'
  // context –ù–ï–¢!
})
```

### 3. ‚úÖ **AI API** (–±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ)
```typescript
// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
messages: [
  { role: "system", content: aiPrompt },
  ...msgs  // –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è —Å —Ä–æ–ª—è–º–∏
]
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω **spor3s_bot** (tg-bot/bot.ts)

**–ë—ã–ª–æ:**
```typescript
.select('content')  // —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
const messages = recentMessages?.reverse().map(msg => ({
  role: 'user',  // –≤—Å—ë –∫–∞–∫ user
  content: msg.content
}))
```

**–°—Ç–∞–ª–æ:**
```typescript
.select('role, content')  // –ø–æ–ª—É—á–∞–µ–º –∏ —Ä–æ–ª—å!
const messages = recentMessages?.reverse().map(msg => ({
  role: msg.role || 'user',  // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ä–æ–ª—å
  content: msg.content
}))

console.log('[spor3s_bot] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ AI –∫–æ–Ω—Ç–µ–∫—Å—Ç:', messages.length, '—Å–æ–æ–±—â–µ–Ω–∏–π');
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω **Mini App Chat** (spor3s-app/app/(client)/chat.tsx)

**–ë—ã–ª–æ:**
```typescript
body: JSON.stringify({
  message: input.trim(),
  user_id: userId,
  source: 'mini_app'
  // –∫–æ–Ω—Ç–µ–∫—Å—Ç –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è!
})
```

**–°—Ç–∞–ª–æ:**
```typescript
// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ä–æ–ª—è–º–∏ –¥–ª—è AI
const context = recentMessages.map(msg => ({
  role: msg.role,
  content: msg.content
}));

console.log('[Mini App Chat] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç:', context.length, '—Å–æ–æ–±—â–µ–Ω–∏–π');

body: JSON.stringify({
  message: input.trim(),
  context: context,  // –ø–µ—Ä–µ–¥–∞–µ–º –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é!
  user_id: userId,
  source: 'mini_app'
})
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å **–í–°–ï –¢–†–ò** —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

| –°–∏—Å—Ç–µ–º–∞ | –ü–µ—Ä–µ–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç | –†–∞–∑–ª–∏—á–∞–µ—Ç —Ä–æ–ª–∏ | –ü–æ–º–Ω–∏—Ç –¥–∏–∞–ª–æ–≥ |
|---------|------------------|----------------|---------------|
| ü§ñ spor3s_bot | ‚úÖ | ‚úÖ | ‚úÖ |
| üåê Mini App | ‚úÖ | ‚úÖ | ‚úÖ |
| üß† AI API | ‚úÖ | ‚úÖ | ‚úÖ |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Telegram Bot
```
User: —Ö–æ—á—É –µ–∂–æ–≤–∏–∫
Bot: [–ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–æ –µ–∂–æ–≤–∏–∫]

User: –ø–æ—Ä–æ—à–æ–∫
Bot: –û—Ç–ª–∏—á–Ω–æ! –ï–∂–æ–≤–∏–∫ –≤ –ø–æ—Ä–æ—à–∫–µ 100–≥ ‚Äî 1100‚ÇΩ
     (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä, –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–Ω–æ–≤–æ)
```

### –¢–µ—Å—Ç 2: Mini App
```
User: —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ —Å–Ω–æ–º?
Bot: –ú—É—Ö–æ–º–æ—Ä –∫—Ä–∞—Å–Ω—ã–π –æ—Ç–ª–∏—á–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ —Å–Ω–æ–º

User: –∞ –≤ –∫–∞–ø—Å—É–ª–∞—Ö –µ—Å—Ç—å?
Bot: –î–∞, –µ—Å—Ç—å –≤ –∫–∞–ø—Å—É–ª–∞—Ö 60 —à—Ç –∑–∞ 1100‚ÇΩ
     (–ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ —Ä–µ—á—å –æ –º—É—Ö–æ–º–æ—Ä–µ)
```

---

## üöÄ –î–µ–ø–ª–æ–π

### –õ–æ–∫–∞–ª—å–Ω–æ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd tg-bot
npx ts-node bot.ts
```

### –ù–∞ VPS
```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã
scp tg-bot/bot.ts root@185.166.197.49:/var/www/spor3s-app/tg-bot/
scp spor3s-app/app/\(client\)/chat.tsx root@185.166.197.49:/var/www/spor3s-app/spor3s-app/app/\(client\)/

# –ù–∞ VPS
ssh root@185.166.197.49
cd /var/www/spor3s-app

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Next.js
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart spor3s-nextjs
pm2 restart spor3s-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs --lines 50
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [x] spor3s_bot –ø–æ–ª—É—á–∞–µ—Ç role –∏–∑ –ë–î
- [x] spor3s_bot –ø–µ—Ä–µ–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ AI API
- [x] Mini App —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç context —Å —Ä–æ–ª—è–º–∏
- [x] Mini App –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ AI API
- [x] AI API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é (–±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ)
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã console.log –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìä –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç:
```
[spor3s_bot] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ AI –∫–æ–Ω—Ç–µ–∫—Å—Ç: 5 —Å–æ–æ–±—â–µ–Ω–∏–π
[Mini App Chat] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç: 7 —Å–æ–æ–±—â–µ–Ω–∏–π
[AI API] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π: 7
[AI API] 1. user: —Ö–æ—á—É –µ–∂–æ–≤–∏–∫
[AI API] 2. assistant: –û—Ç–ª–∏—á–Ω–æ! –ï–∂–æ–≤–∏–∫...
[AI API] 3. user: –ø–æ—Ä–æ—à–æ–∫
```

---

**–ì–æ—Ç–æ–≤–æ! üéâ –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç—Ä–∏ —á–∞—Ç–∞ –ø–æ–º–Ω—è—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ–±—â–∞—é—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.**

