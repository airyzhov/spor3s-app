#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –±–æ—Ç–∞ –Ω–∞ VPS —á–µ—Ä–µ–∑ SSH

echo "üöÄ –î–ï–ü–õ–û–ô –ë–û–¢–ê –ù–ê VPS"
echo "===================="
echo ""

# 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ VPS
cd /root/spor3s-app/spor3s-app || cd /var/www/spor3s-app/spor3s-app || exit 1

echo "üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
echo ""

# 2. –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ GitHub
echo "üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ GitHub..."
git pull origin main

echo ""

# 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
npm install

echo ""

# 4. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pm2 stop spor3s-bot 2>/dev/null || true
pm2 stop spor3z-agent 2>/dev/null || true
pm2 delete spor3s-bot 2>/dev/null || true
pm2 delete spor3z-agent 2>/dev/null || true

echo ""

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –±–æ—Ç
echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
pm2 start final-bot-fix.js --name "spor3s-bot"

echo ""

# 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
echo "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PM2..."
pm2 save

echo ""

# 7. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
echo "‚öôÔ∏è  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞..."
pm2 startup

echo ""

# 8. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
pm2 list

echo ""

# 9. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:"
pm2 logs spor3s-bot --lines 10 --nostream

echo ""
echo "üéâ –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù!"
echo "===================="
echo ""
echo "üí° –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
echo "   pm2 list                - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "   pm2 logs spor3s-bot     - –ª–æ–≥–∏ –±–æ—Ç–∞"
echo "   pm2 restart spor3s-bot  - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫"
echo "   pm2 stop spor3s-bot     - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞"
echo ""
echo "üì± –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram: @spor3s_bot"
echo ""